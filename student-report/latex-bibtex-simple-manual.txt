file: latex-bibtex-simple-manual.txt = introduction to latex and bibtex 
last: May  5 2014 

    
     SIMPLE LATEX AND BIBTEX INSTRUCTION FOR ASTRONOMY STUDENTS

                     Robert J. Rutten

                Lingezicht Astrophysics Deil
          Institutt for Teoretisk Astrofysikk Oslo 


This simple latex and bibtex tutorial tells you how to write a report
that will be closely similar in appearance to A&A and ApJ papers, and
is easily modified into an A&A or ApJ manuscript.

There are parallel txt, pdf, and html versions of this manual at 
  <<http://www.staff.science.uu.nl/~rutte101/Manuals.html>>
The html and pdf versions have active weblinks.

This manual was initially written for second-year astronomy students
at Utrecht University doing the "Stellar Spectra" exercises at
  <<http://www.staff.science.uu.nl/~rutte101/Exercises.html>>
   
   
Startup
=======

 - begin by getting and unzipping file 
     studentreportfiles.zip 
   at 
     <<http://www.staff.science.uu.nl/~rutte101/rrweb/rjr-edu/manuals/student-report>>
   to obtain the example LaTeX input file
     example.tex
   the associated BibTeX database file
     example.bib
   and the associated figure 
     waterfalls.ps  waterfalls.pdf
   
   You may also need to have style files 
     aa.cls
     aa.bst
     txfonts.sty
     twoopt.sty
   which normally reside in a separate directory that LaTeX and BibTeX
   can find by themselves.  If you don't know how to set the search
   path then put these also in your report writing directory.

 - you may use latex etc commands in a terminal (Unix/Linux/MacOS)
   or use a more elaborate interface as Texmaker, TeXworks, WinEdt,
   TeXShop, Latexian, Texpad, etc.
   Process the example file example.tex to see what it does:
     latex - bibtex - latex - latex - inspection  
   using Adobe Reader for the latter.  Print from the Adobe print menu.
   
 - under Unix/Linux/MacOS in a terminal or with auctex from emacs:
     latex example     # warns about undefined citations and references 
     latex example     # only undefined citations; figure references OK 
     bibtex example    # uses example.aux to make example.bbl from example.bib
     latex example     # puts refs from example.bbl into the .aux file
     latex example     # no complaints anymore: done
     xdvi example &    # .dvi preview; click to refresh after text changes
       and when you are done 
     dvips -z example -o example.ps    # produce PostScript output
     gv example.ps                     # inspect PostScript output
     lpr -Pprintername example.ps      # print PostScript output
     ps2pdf -dUseCIEColor=true -dPDFSETTINGS=/printer example.ps  # make pdf
     pdflatex example          # also makes a pdf but needs .pdf figures
     acroread example.pdf &    # inspect pdf output; print from menu

 - inspect the input file example.tex and the output and study in
   detail how the former generates the latter.


Template
=========

 - file template.tex is the same as example.tex but without textual
   content.  Copy it into a new file XXXX.tex to start a new report.
  
 - a template for Astronomy and Astrophysics (A&A) papers is easily
   made by replacing my header stuff by the pertinent A&A commands
   (\title, \author, \titlerunning, \institute, \date, \offprints,
   \abstract, \keywords and \maketitle).  The rest remains the same.

 - a template for Astrophysical Journal (ApJ) papers is easily made by
   replacing the aa.cls and aa.bst files by the ApJ styles and the
   header stuff by the ApJ commands.  The rest remains the same.
   Unfortunately, IOP's processing does not retain ADS-clicker citations.

   
LaTeX text typing (check this most carefully!  Make it habits!)
===============================================================

 - use WinEdt or a Unix/Linux/MacOS editor to type the latex input text
   (Emacs has special features and hooks for LaTeX and BibTeX).
   Type pure ASCII: generate accents etc with LaTeX \ commands.
   Good typing habits:
    - indent equations and environments as in programming
    - add comments to clarify your layout and what you are doing
      (LaTeX skips the remainder of a line after %, type \% to get %)
    - consider starting each new sentence on a new line (in Emacs this
      can be automated with the .emacs settings at
  <<http://www.staff.science.uu.nl/~rutte101/Recipes_linux_unix_MacOSX.html>>
  
 - new paragraph = 1 or more blank lines, not ....\\[1ex]

 - spaces: 
     multiple spaces is the same as a single space
     no-line-break-space: ~      R.J.~Rutten,   1083.0~nm line
       (otherwise you may get the unit nm on the next line)
     code space after period after small character: Prof.\ Dr.\ C.~Zwaan
       (otherwise LaTeX adds more space taking it to be end of a sentence)
     code space after LaTeX command: 4554~\AA\ line, but \AA. Nordlund
       (otherwise LaTeX eats up the space as command delimiter)
       
 - dashes: hyphen = -            magneto-acoustic   
           longer dash = --      5--min oscillation    
           longest dash =  ---   he said---but I think (ApJ habit)
                                 he said -- but I think (A&A habit)

 - quotation marks: use ``......'', never "...."

 - mathematics:
     $...$ for in-text math 
     never use \frac in in-text math (too small), use $a/b$ instead
     \begin{equation}  
        ........         for displayed & numbered equation (indent!)
        \label{eq:whatever}
     \end{equation}    
     Use \sin, \cos, \exp  etc   ($sin$ means product s i n)
     Use roman alphabet for non-mathematical indices 
       (code only math variables in math notation ($x$), cf. A&A manual):
        $T_{\rm eff}$      
               ($T_{eff}$ makes eff = product e, f and f)
        \begin{equation}
           B_\nu(T) = \frac{2\pi m_{\rm e} c^2}{h^3}   
                %% e = electron
                      \frac{1}{\exp{-h\nu/kT}-1}
           \label{eq:Planck}
        \end{equation}
     Use {\rm d} or \partial for differential d  
     Add thin space with \, before differential d, {\rm e}^{..} etc
     Shrink space: for the $n\!=\!2$ level   
     Add punctuation after equations, just as in normal text
     
 - numbers and units: 
     $B_\nu = 5\,10^{12}$~erg\,cm$^{-2}$\,s$^{-1}$\,sterad$^{-1}$
     $v=50$~km\,s$^{-1}$ velocity  
     180~s  10~mHz      
     a $40 \times 30$~arcsec$^2$ field 
   alternative is to use smaller blank space with \,:
     50\,km\,s$^{-1}$ velocity
     the Ba\,II\,4554\,\AA\ line (NB: the \ after \AA to get a normal space)
     10\,mHz frequency
     at $\lambda \approx 160$\,nm one observes
  
 - crossreferences:
     make all references to figures, tables, equations, sections 
     dynamic by adding labels to them:
       \label{fig:power images}
       \label{tab:lines}
       \label{eq:mass conservation}
       \label{sec:discuss}
     and refering to these as:
       in Section~\ref{sec:discuss} we discuss 
       Figure~\ref{fig:power images} shows power spectra
       (see Figs.~\ref{fig:xx}, \ref{fig:xx}---\ref{fig:xx})
       inserting this result into eq.~(\ref{eq:mass conservation})
     NB: LaTeX needs to be run twice to get all crossreferences right.
     
 - literature citations and references:
   Most astronomers and astronomy journals use the name-year system:
   .... by Rutten and Schrijver (1994) 
          (see Schrijver, 1993e; Rutten, 1993).
   .... (cf.\ Rutten \& Schrijver 1994)  
   but Nature and some others use numbered references.
   See example.tex and below for automatic reference generation with BibTeX.
   

LaTeX processing
================

When your XXXX.tex file is done or half done, process it as the
example file above (latex - latex - bibtex - output) and inspect the
output.

LaTeX errors are usually due to unmatched pairs of $$, {}, \begin and
\end.  I often mistakenly type $ for & in tables.

If you don't like the layout, do not try local solutions such as
ad-hoc white space, but adapt the formats by more general commands at
the start of your file.  You may feel that LaTeX confines you to
overly restrictive straightjackets.  Then switch to TeX ("the
sportscar engine under the hood of the LaTeX sedan") - but first ask
yourself whether you want to be a professional typesetter or a
professional astronomer.  For astronomical papers you need to adhere
strictly to the style of the publisher.  They have chosen LaTeX in
order to fix the layout their way without bothering you or being
bothered by you.  So don't try to re-invent the wheel!
  
When you are happy with what the previewer shows:
    aspell -t --dont-check-cmments check XXXX.tex     # check for typos
    aspell -t -d british --dont-tex-check-comments check XXXX.tex   # in UK
    latex XXXX                                        # final version

To clean your working directory from all the LaTeX auxiliary files, 
you might in Unix/Linux/MacOS define a command like:
   alias rmtex 'rm *.aux *.dvi *.lis *.log *.blg *.bbl *.toc'
The text.tex file and the figure.ps (or .eps or .pdf) files are the
only ones which you need to keep.  They regenerate all others.


References 
==========

 - my example.tex file closely copies habits of A&A.  The references are
   formatted in the style used by A&A and ApJ, as defined in Bibtex
   style file aa.bst (or my adsaa.bst modification).  For other
   journals hunt the web for an appropriate XXX.bst bibstyle file.

 - the corresponding BibTeX input file example.bib has the necessary
   BibTeX "items" copied directly from ADS
     <<http://adsabs.harvard.edu/default_service.html>>
   which has a clicker supplying these underneath every abstract.  But
   sometimes, especially for proceedings publications, you need to
   improve the ADS entry.

 - the example file uses my \citeads citation commands.  These turn
   the in-text citation into a clicker that opens the corresponding
   ADS abstract page in your browser (if your Adobe Reader [acroread]
   setup permits internet access.  This is an option under Edit >
   Preferences > Trust Manager > Change Settings that Adobe seems to
   have defaulted off on the advice of the infamous NSA in 2013).
   Such opening is convenient in on-screen reading because it shows
   the cited paper in parallel to one's reading, without jump to the
   reference list.  These commands require that you use separate
   \citeads commands per cited paper using its ADS label.  This trick
   survives in the A&A production process and is recommended by A&A.
   It also survives in the pdf generation by arXiv (Astroph).  I don't
   know whether it survives the non-latex production of ApJ by IOP.
   In addition, my adsaa.bst modification of aa.bst adds the ADS codes
   to the references.  These are also clickable and may be useful to
   hyperlink-challenged printed-paper readers.
   ## Note added May 12 2014: I now use a newer texlive installation
      in which these \citeads macros generate non-fatal error
      warnings: "Illegal parameter number in definition of \Hy@temp"
      when calling latex (but not when calling pdflatex).
      I haven't found a proper correction yet and therefore added a fix
      making latex not stop at error messages within these \citeads
      commands.       

 - in my own writing I use automatic scripts to download all the
   abstracts and corresponding BibTeX items for all publications by
   all my colleagues.  I so maintain my own abstract collection, see
   <<http://www.staff.science.uu.nl/~rutte101/Solar_physicist_abstract.html>>
   While writing I simply copy the ADS bibcode found in these
   abstracts into a \citeads command into my manuscript LaTeX file, and
   let BibTeX find the corresponding reference info by searching the
   whole database.  See:
   <<http://www.staff.science.uu.nl/~rutte101/Recipes_bibtex.html>>


Figures
=======
 
 - figure location: I keep my figure files in a subdir \figs per paper.

 - layout: keep your figures small but make their labeling large.  Aim
     at vertical panel stacking for A&A manuscripts or other
     column-style publications.  Often you should remove the axis
     annotation between adjacent same-scale panels to gain space.

 - multipanel figures: I do not make multipanel figures in IDL (a
     hassle) but prepare standalone figures with full axis annotation
     for each panel in IDL and then do the multi-panel assembly in
     latex, stripping off the axis annotation where desired.  The
     advantage of this approach is that I can choose between page-wide
     horizontal or column-high vertical panel assembly depending on
     how the paper layout comes along, while I am writing it.  Without
     bothering co-authors that have contributed figures.  I do such
     assembly using my self-explanatory template file
     <<http://www.staff.science.uu.nl/~rutte101/rrweb/rjr-edu/manuals/student-report/cutmultipanel.tex>>

 - color: usually too expensive for publication on paper but fine for
     web distribution.  Remember that red-green color blindness is
     quite common (7-10% of all males).

 - figure location: you have to find by trial where to stick a
     particular {figure} environment in your LaTeX input file to get
     it to a suitable location in the output.  It comes at or after
     the insert location in your text, not before.  The same holds for
     other "floats" such as tables.  Always have figures and tables
     surrounded by blank lines in your input xxx.tex file.

 - figure clipping:
     \includegraphics[bb = 11 278 408 544,width=88mm,clip]
     where the four numbers are the x and y of the lower-left 
     and upper-right corners of the cutting box in bp units.  You can
     measure these manually with Ghostview, in Unix/Linux/MacOS with 
        gv figure.ps
     which displays the cursor position in bp units at the upper left.

 - figure stealing in Adobe Reader:
    - open the pdf file 
    - click on the "graphic select tool" button
    - draw cutout rectangle
    - right mouse button: print 
    - print menu: selected graphic on; save to file figure.ps
    - cut bounding box: see below

 - figure stealing in MacOS:
    - open the pdf file with open -a Preview file.pdf 
    - click on the "graphic select tool" button
    - draw cutout rectangle
    - Apple C, Apple N
    - file menu: save to file figure.pdf

 - figure conversion ps, eps, pdf in Unix/Linux/MacOS:
     ps2eps file.ps       # cut the bounding box, but it can misfire
     ps2epsi file.ps      # idem, sometimes better
     epstopdf file.ps     # convert ps or eps into pdf
     pdfcrop file.pdf     # cut figure to its actual bonding box (no white)
     pdfcrop --margins  "5 5 5 5" file.pdf   # idem with small white margin

 - figure conversion to .png for presentation displays in Unix/Linux/MacOS: 
     I use script
       #!/bin/csh
       epstopdf $1
       pdfcrop --margins 5 $1:gr.pdf
       convert -density 400 -geometry 1024x768 -background white -flatten $1:gr-crop.pdf $1:gr.png
       rm -f $1:gr.pdf $1:gr-crop.pdf
     and I may annotate the png product with the reference through 
     a similar script with entries:
       pdfcrop --margins "5 20 5  5" $2:gr.pdf
       convert -density 400 -geometry 1024x768 -background white -flatten -font "-misc-fixed-medium-r-normal-*-20-*-*-*-*-*-*-*" -fill black -draw "text 10,15 '${1}'" $2:gr-crop.pdf  ann-$2:gr.png

  - ps figure conversion to smaller file size (when they have too much detail,
    for example scatter plots, or for arXiv) with Unix/Linux/MacOS script:
      #!/bin/csh
      epstopdf $1
      pdfcrop $1:gr.pdf
      convert -density 500 -geometry 3000x2000 -background white -flatten
        $1:gr-crop.pdf  $1:gr.jpg
      jpeg2ps -h $1:gr.jpg > small-$1:gr.eps
      rm -f $1:gr.pdf $1:gr-crop.pdf $1:gr.jpg


Other manuals
=============

 - Leslie Lamport's original latex book remains one of the best
   manuals ever written.  It is the only printed manual which I still
   use (I Google any other software question).  Usually I look up a
   final Part-C entry in the index to check the complete definition.

 - the "LaTeX Companion" book offers many tricks but most are not
   needed by astrophysicists.  Electronic version for sale at:
   <<http://www.latex-project.org/guides/books.html#latex-english>>

 - Google <latex manual> <simple latex manual> delivers many good
   to excellent manuals.

 - Google <A&A> leads you to the A&A website with extensive writing
   instructions for A&A papers.
   
 - Google <ApJ> leads you to an ApJ website which directs you to the
   AASTeX instructions and macros for ApJ manuscript preparation.  

 - Natbib reference sheet:
     <<http://merkel.zoneo.net/Latex/natbib.php>>
